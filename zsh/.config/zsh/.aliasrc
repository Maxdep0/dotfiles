alias so="source $HOME/.config/zsh/.zshrc"

alias rm="rm -i"

check() {
    "ps -T -p $(pgrep -x node | paste -sd,) 2>/dev/null"
    ps -eo cmd --no-headers | sort | uniq -c | awk "\$1 > 1"
    ps -eo pid,comm,args,%mem,%cpu --sort=-%mem | head -n 20
    ps -eo pid,comm,%cpu --sort=-%cpu | head

}

# prettyJson file level field
prettyJson() {
  if [[ -z "$1" ]]; then
    return 1
  fi

  local src="$1"; shift
  local lvl="${1:-}"; [[ -n "$lvl" ]] && shift
  local -a fields=("$@")
  local fields_str=""
  (( ${#fields[@]} )) && fields_str="${(j:,:)fields}" 

  local filter='
    def gp($k): getpath($k | split("."));
    ( if ($lvl == "") then . else select(.level == $lvl) end ) as $o
    | if ($fields == "") then
        $o
      else
        ($fields | split(",")) as $fs
        | if ($fs|length) == 1 then
            ($o | gp($fs[0]) // empty)
          else
            reduce $fs[] as $k ({}; . + { ($k): ($o | gp($k)) })
          end
      end
  '

  if [[ "$src" == "-" ]]; then
    jq -C --unbuffered --arg lvl "$lvl" --arg fields "$fields_str" "$filter"
  else
    jq -C --arg lvl "$lvl" --arg fields "$fields_str" "$filter" < "$src"
  fi
}

alias tre="command tree --gitignore"
alias trea='command tree -a -I '\''node_modules|.git|go|.nvm|.nv|.npmrc|.node_repl_history'\'''

alias d="dirs -v"
for index in {1..99}; do alias "$index"="cd +$index"; done

paci() {
    case "$1" in
    install | i) sudo pacman -S --needed "${@:2}" ;;
    remove | r) sudo pacman -Rns "${@:2}" ;;
    update | u) sudo pacman -Syu ;;
    find | f) pacman -Ss "${@:2}" ;;
    info) pacman -Si "${@:2}" ;;
    list | l) pacman -Qe ;;
    listAll | la) pacman -Qn ;;
    tree | t) pactree "${2}" ;;
    clean | c) sudo pacman -Sc && sudo paccache -rvk2 ;;
    orphans | o) pacman -Qtdq ;;
    purgeOrphans | po)
        orphans=$(pacman -Qtdq)
        [[ -n $orphans ]] && sudo pacman -Rns $orphans || echo "No orphans."
        ;;
    unlock) sudo rm -f /var/lib/pacman/db.lck ;;
    help | *) cat <<'EOF' ;;
Usage: paci <sub-cmd> [args]
  i|install        install packages
  r|remove         remove packages
  u|update         full upgrade
  f|find           repo search
  info             show package info
  l|list           explicitly installed
  la|listAll       all repo/native packages
  t|tree           dependency tree
  c|clean          clean cache
  o|orphans        list orphaned deps
  po|purgeOrphans  remove orphaned deps
  unlock           delete pacman lock
EOF
    esac
}

yayi() {
    case "$1" in
    install | i) yay -S --needed "${@:2}" ;;
    remove | r) yay -Rns "${@:2}" ;;
    update | u) yay -Syu ;;
    find | f) yay -Ss "${@:2}" ;;
    info) yay -Si "${@:2}" ;;
    list | l) yay -Qm ;;
    listAll | la) yay -Qm ;;
    clean | c) yay -Yc ;;
    orphans | o) yay -Qtdq ;;
    purgeOrphans | po)
        orphans=$(yay -Qtdq)
        [[ -n $orphans ]] && yay -Rns $orphans || echo "No orphans."
        ;;
    help | *) cat <<'EOF' ;;
Usage: yayi <sub-cmd> [args]
  i|install        install (AUR)
  r|remove         remove
  u|update         full upgrade
  f|find           search
  info             show package info
  l|list           installed AUR pkgs
  la|listAll       all AUR pkgs
  c|clean          clean yay cache
  o|orphans        list orphaned deps
  po|purgeOrphans  remove orphaned deps
EOF
    esac
}

alias ..="cd .."
alias ...="cd ../.."

pro() {
    if [[ -n $1 && -d ~/Projects/$1 ]]; then
        cd ~/Projects/"$1"
    else
        cd ~/Projects && fd -H -d 1
    fi
}

alias .dot="cd ~/.config"
alias dot="cd ~/dotfiles"

alias nvimc="cd ~/.config/nvim && nvim init.lua"
alias teztermc="cd ~/dotfiles/wezterm/.config/wezterm && nvim wezterm.lua"
alias swayc="cd ~/dotfiles/sway/.config/sway && nvim config"
alias hyprc="cd ~/dotfiles/hypr/.config/hypr && nvim hyprland.conf"
alias barc="cd ~/dotfiles/waybar/.config/waybar && nvim config.jsonc"
alias zshc="cd ~/dotfiles/zsh/.config/zsh && nvim .zshrc"
alias envc="cd ~/dotfiles/zsh && nvim .zshenv"
alias aliasc="cd ~/dotfiles/zsh/.config/zsh && nvim .aliasrc"

alias play="prime-run mpv --hwdec=nvdec --vo=gpu --gpu-context=wayland --video-sync=display-resample --interpolation --framedrop=vo"
alias img="feh"
alias grep="grep -P -i --color=auto"

alias cl="clear"

alias l="ls -A --color=auto"

if [[ -f "/usr/bin/fd" ]] || [[ -f "$HOME/bin/fd" ]] || [[ -f "$HOME/.local/bin/fd" ]]; then
    alias fdf='fd -H -d 1 -t f'
    alias fdd='fd -H -d 1 -t d'
    alias fda='fd -H -d 1'
fi
